<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Role Management</title>
    <link rel="stylesheet" th:href="@{/CSS/exam.css}" />
    <link rel="stylesheet" th:href="@{/CSS/common.css}" />
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans|Roboto|Source+Sans+Pro&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Varela+Round&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script>
        $(function(){
            $.ajax({
                url:"/getUsers",
                method:"POST",
                success:fillUsers
            })
        });
        function fillUsers(users) {
            $("#userSelect").empty();
            var userString = "<option value='-1'>Select User</option>";
            for (var i = 0; i < users.length; i++) {
                userString+="<option value='"+users[i].id+"'>"+users[i].name+"</option>"
            }
            $("#userSelect").append(userString);

        }
        function loadButtons() {
            $("#buttons").empty();
            var userId = $("#userSelect").val();
            if (userId !== "-1") {
                var buttonsText = "<p>Would you like to add or remove roles for the selected user?</p>" +
                "<button onclick='addRoles()' class='gradeLabel'>Add Role</button>" +
                "<button onclick='removeRoles()'>Remove Role</button>";
                $("#buttons").append(buttonsText);
            }
        }
        function addRoles() {
            $.ajax({
                url:"/getUnusedRoles",
                method:"POST",
                data:{id:$("#userSelect").val()},
                success:fillAdd
            })
        }
        function removeRoles(){
            $.ajax({
                url:"/getUserRoles",
                method:"POST",
                data:{id:$("#userSelect").val()},
                success:fillRemove
            })
        }
        function fillAdd(roles) {
            fillList(roles,"<button onclick='addRole()'>Add New Role</button>")

        }
        function fillRemove(roles) {
            fillList(roles, "<button onclick='removeRole()'>Remove Role</button>");

        }
        function fillList(roles, buttonInfo) {
            $("#buttons").empty();
            var list = "<select id='selectedRole' class='gradeLabel'>";
            for (var i = 0; i < roles.length; i++) {
                list+="<option value='"+roles[i]+"'>"+roles[i]+"</option>"
            }
            list+="</select>" + buttonInfo;
            $("#buttons").append(list);
        }
        function addRole() {
            $.ajax({
                url:"/addUserRole",
                method:"POST",
                data:{id:$("#userSelect").val(), role:$("#selectedRole").val()},
                success:roleResult
            })
        }
        function removeRole() {
            $.ajax({
                url:"/removeUserRole",
                method:"POST",
                data:{id:$("#userSelect").val(), role:$("#selectedRole").val()},
                success:roleResult
            })
        }
        function roleResult(result) {
            if(result === true) {
                $("#buttons").empty();
                alert("Operation successful");
            } else {
                alert("An issue occurred attempting to perform the operation")
            }
        }
    </script>
</head>
<body>
<div id='top'>
    <span id="title" class="logo"><strong>One Connect</strong></span>
    <span><button class='fa fa-gear settings-button' onclick="window.location.href='#'"></button></span>
    <span id='info'><span th:text="${name}"></span><br/><span th:text="${school}"></span></span>
</div>

<div class=classheader>
    <a href="#" onclick="$('#form').submit()">Home</a>
    <i class="fa fa-chevron-right header-chevron"></i>
    <a>Role Management</a>
</div>

<div class='columns'>

    <div class='box'>
        <div>
            <h2>Role Management</h2>
            <div>
                <label for="userSelect" class="gradeLabel" >Select User</label>
                <select id = "userSelect" onchange="loadButtons()">
                    <option value = "-1">Select User</option>
                </select>
                <div id="buttons">

                </div>
            </div>
        </div>




    </div>
    <form action="/landing" method="POST" id="form">
        <input type='hidden' id='id' name='id' th:value='${userId}'/>
        <input type='hidden' id='role' name='role' th:value='${role}'/>
    </form>
</div>

</body>
</html>